import logging
import subprocess
import sys

from git import Repo
from common.system_info import SystemInfo
from typing import Dict, List

argument_registry: Dict = {}


# TODO check what exactly returns clone_from and base on output check if repo was cloned properly
def clone_repo(url: str) -> str:
    save_path = SystemInfo().get_repo_save_path(url.split('/')[-1][:-4])
    logging.info(f"Starting cloning {url.split('/')[-1][:-4]}...")
    repo = Repo.clone_from(url, save_path)
    logging.info(f"Successfully cloned {url.split('/')[-1][:-4]}")
    return save_path


def pip_install(package: str):
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', '--upgrade', package])


# TODO implement
def docker_pull(image: str):
    pass


def register(flags: List[str], help: str, category: str):
    def decorator_argument(func):
        argument: Dict = {
            'method': func,
            'flags': flags,
            'help': help,
            'category': category
        }
        argument_registry[func.__name__] = argument
        return func
    return decorator_argument
